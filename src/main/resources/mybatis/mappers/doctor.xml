<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="doctor">
	<select id="getTreatList" parameterType="long" resultType="doctorvo">
		<![CDATA[
			select 
				a.date as appointmentDate, 
				a.remarks as appointmentRemark, 
				b.no as patientNo, 
				b.name as patientName, 
				a.employee_no as employeeNo
			from appointment a 
			left join patient b on a.patient_no = b.no
			where a.patient_no= #{no}
			
		]]>
	</select>
	
	
	
	
	<!-- 의사 진료 완료했을 때 start -->
	<insert id="insertDiagnosis" parameterType="diagnosisVo">
		<![CDATA[
			insert into diagnosis(appointment_no, opinion, patient_no) values (#{appointmentNo},#{opinion}, #{patientNo});
		]]>
		<selectKey keyProperty="no" resultType="long" order="AFTER">
			<![CDATA[
				select last_insert_id();
			]]>
		</selectKey>
	</insert>
	
	<insert id="insertPrescription" parameterType="prescriptionVo">
		<![CDATA[
			insert into prescription(medicine_name, dose, dosing_prequency, dosing_days, remark, diagnosis_no) 
			values (#{medicineName},#{dose},#{dosingPrequency},#{dosingDays},#{remark},#{diagnosisNo});	
		]]>
	</insert>
	
	<insert id="insertDisease" parameterType="diseaseVo">
		<![CDATA[
			insert into disease(disease_name, diagnosis_no) values (#{diseaseName}, #{diagnosisNo});		
		]]>
	</insert>
		
	<insert id="insertTreatment" parameterType="treatmentVo">
		<![CDATA[
			insert into treatment(	medicine_name, treat, dose, diagnosis_no) 
			values (#{medicineName}, #{treat}, #{dose}, #{diagnosisNo});	
		]]>
	</insert>
	
	<update id="updateAppointment" parameterType="appointmentVo">
		<![CDATA[
			update appointment set status = #{status} where no = #{no}
		]]>
	</update>	
	<!-- 의사 진료 완료했을 때 end -->
	
	
	
	
	<!-- 모달(팝업)창 안에 들어갈 내용 start -->
	<select id="getDiease" parameterType="string" resultType="diseasedatavo">
		<![CDATA[
			select 
				disease_number as diseaseNumber,
				disease_name as diseaseName
			from disease_data
			where disease_name like concat('%', #{name}, '%')
		]]>
	</select>
	
	<select id="getMedicine" parameterType="string" resultType="medicinedatavo">
		<![CDATA[
			select 
				medicine_number as medicineNumber,
				medicine_name as medicineName,
				medicine_unit as medicineUnit
			FROM medicine_data		
			where medicine_sort=1
			and medicine_name like concat('%', #{name}, '%')
		]]>
	</select>
	
	<select id="getTreatment" parameterType="string" resultType="medicinedatavo">
		<![CDATA[
			select 
				medicine_number as medicineNumber,
				medicine_name as medicineName,
				medicine_unit as medicineUnit
			FROM medicine_data		
			where medicine_sort=2
			and medicine_name like concat('%', #{name}, '%')
		]]>
	</select>
	<!-- 모달(팝업)창 안에 들어갈 내용 end -->
</mapper>