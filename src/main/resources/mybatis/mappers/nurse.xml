<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="nurse">
	<select id="findAllPatients" resultType="patientVo">
		<![CDATA[
			select * from patient;
		]]>
	</select>
	<select id="findPatientByNo" resultType="patientVo">
		<![CDATA[
			select * from patient where no = #{no};
		]]>
	</select>
	<select id="findPatientByName" resultType="patientVo">
		<![CDATA[
			select * from patient where name = #{name};
		]]>
	</select>
	<insert id="insertPatient" parameterType="patientVo">
		<![CDATA[
			insert into patient(name, rrn, address, phone_number, gender, has_insurance, reg_date, hospital_no) 
			values (#{name},#{rrn}, #{address}, #{phoneNumber}, #{gender}, #{hasInsurance}, #{regDate}, #{hospitalNo});
		]]>
		<selectKey keyProperty="no" resultType="long" order="AFTER">
			<![CDATA[
				select last_insert_id();
			]]>
		</selectKey>
		
	</insert>
	<select id="findAllAppointments" resultType="nurseVo">
		<![CDATA[
			SELECT 
				a.no as appointmentNo,
				a.date as appointmentDate,
			    b.name as patientName,
			    b.rrn as patientAge,
			    b.gender as patientGender,
			    a.remarks as appointmentRemarks,
			    a.status as appointmentStatus,
			    c.name as doctorName
			FROM appointment a
			LEFT JOIN patient b on a.patient_no = b.no
			LEFT JOIN employee c on a.employee_no = c.no;
		]]>
	</select>
	<select id="findAppointmentByPatientNo" resultType="nurseVo">
	<![CDATA[
			SELECT 
				a.no as appointmentNo,
				a.date as appointmentDate,
			    b.name as patientName,
			    b.rrn as patientAge,
			    b.gender as patientGender,
			    a.remarks as appointmentRemarks,
			    a.status as appointmentStatus,
			    c.name as doctorName
			FROM appointment a
			LEFT JOIN patient b on a.patient_no = b.no
			LEFT JOIN employee c on a.employee_no = c.no
			WHERE a.patient_no = #{no};
			
		]]>
	</select>
	<select id="findAppointmentByPatientName" resultType="nurseVo">
	<![CDATA[
			SELECT
				a.no as appointmentNo,
			    a.date as appointmentDate,
			    b.name as patientName,
			    b.rrn as patientAge,
			    b.gender as patientGender,
			    a.remarks as appointmentRemarks,
			    a.status as appointmentStatus,
			    c.name as doctorName
			FROM
				appointment a
			LEFT JOIN patient b ON patient_no = b.no
			LEFT JOIN employee c ON employee_no = c.no
			WHERE b.name = #{patientName};
			
		]]>
	</select>
	<insert id="insertAppointment" parameterType="appointmentVo">
		<![CDATA[
			insert into appointment(status, date, remarks, patient_no, employee_no, hospital_no) 
			values (#{status},#{date}, #{remarks}, #{patientNo}, #{employeeNo}, #{hospitalNo});
		]]>
		<selectKey keyProperty="no" resultType="long" order="AFTER">
			<![CDATA[
				select last_insert_id();
			]]>
		</selectKey>
		
	</insert>
</mapper>